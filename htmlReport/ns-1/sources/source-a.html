<!DOCTYPE html>
<html id="htmlId">
<head>
    <title>Coverage Report > FirebaseViewModel</title>
    <style type="text/css">
    @import "../../css/coverage.css";
    @import "../../css/idea.min.css";

    </style>
    <script src="../../js/highlight.min.js" type="text/javascript"></script>
    <script src="../../js/highlightjs-line-numbers.min.js" type="text/javascript"></script>
</head>

<body>
<div class="content">
    <div class="breadCrumbs">
        Current scope: <a href="../../index.html">all classes</a>
        <span class="separator">|</span>
        <a href="../index.html">com.example.sharedcalendar</a>
    </div>

    <h1>Coverage Summary for Class: FirebaseViewModel (com.example.sharedcalendar)</h1>

    <table class="coverageStats">

        <tr>
            <th class="name">Class</th>
            <th class="coverageStat
">
                Method, %
            </th>
            <th class="coverageStat
">
                Line, %
            </th>
        </tr>
        <tr>
            <td class="name">FirebaseViewModel</td>
            <td class="coverageStat">
  <span class="percent">
    85.2%
  </span>
                <span class="absValue">
    (23/27)
  </span>
            </td>
            <td class="coverageStat">
  <span class="percent">
    80.3%
  </span>
                <span class="absValue">
    (94/117)
  </span>
            </td>
        </tr>
        <tr>
            <td class="name">FirebaseViewModel$addEventToCalendar$1</td>
            <td class="coverageStat">
  <span class="percent">
    50%
  </span>
                <span class="absValue">
    (1/2)
  </span>
            </td>
            <td class="coverageStat">
  <span class="percent">
    50%
  </span>
                <span class="absValue">
    (3/6)
  </span>
            </td>
        </tr>
        <tr>
            <td class="name">FirebaseViewModel$addEventToCalendar$1$1</td>
            <td class="coverageStat">
  <span class="percent">
    0%
  </span>
                <span class="absValue">
    (0/1)
  </span>
            </td>
            <td class="coverageStat">
  <span class="percent">
    0%
  </span>
                <span class="absValue">
    (0/3)
  </span>
            </td>
        </tr>
        <tr>
            <td class="name">FirebaseViewModel$addEventToCalendar$1$1$1</td>
            <td class="coverageStat">
  <span class="percent">
    0%
  </span>
                <span class="absValue">
    (0/1)
  </span>
            </td>
            <td class="coverageStat">
  <span class="percent">
    0%
  </span>
                <span class="absValue">
    (0/9)
  </span>
            </td>
        </tr>
        <tr>
            <td class="name">FirebaseViewModel$addShare$1</td>
            <td class="coverageStat">
  <span class="percent">
    50%
  </span>
                <span class="absValue">
    (1/2)
  </span>
            </td>
            <td class="coverageStat">
  <span class="percent">
    50%
  </span>
                <span class="absValue">
    (3/6)
  </span>
            </td>
        </tr>
        <tr>
            <td class="name">FirebaseViewModel$addShare$1$1</td>
            <td class="coverageStat">
  <span class="percent">
    0%
  </span>
                <span class="absValue">
    (0/1)
  </span>
            </td>
            <td class="coverageStat">
  <span class="percent">
    0%
  </span>
                <span class="absValue">
    (0/2)
  </span>
            </td>
        </tr>
        <tr>
            <td class="name">FirebaseViewModel$calendars$1$1</td>
            <td class="coverageStat">
  <span class="percent">
    100%
  </span>
                <span class="absValue">
    (1/1)
  </span>
            </td>
            <td class="coverageStat">
  <span class="percent">
    100%
  </span>
                <span class="absValue">
    (1/1)
  </span>
            </td>
        </tr>
        <tr>
            <td class="name">FirebaseViewModel$calendars$1$2</td>
            <td class="coverageStat">
  <span class="percent">
    0%
  </span>
                <span class="absValue">
    (0/1)
  </span>
            </td>
            <td class="coverageStat">
  <span class="percent">
    0%
  </span>
                <span class="absValue">
    (0/1)
  </span>
            </td>
        </tr>
        <tr>
            <td class="name">FirebaseViewModel$Companion</td>
            <td class="coverageStat">
  <span class="percent">
    100%
  </span>
                <span class="absValue">
    (1/1)
  </span>
            </td>
            <td class="coverageStat">
  <span class="percent">
    100%
  </span>
                <span class="absValue">
    (1/1)
  </span>
            </td>
        </tr>
        <tr>
            <td class="name">FirebaseViewModel$createCalendar$1</td>
            <td class="coverageStat">
  <span class="percent">
    100%
  </span>
                <span class="absValue">
    (2/2)
  </span>
            </td>
            <td class="coverageStat">
  <span class="percent">
    83.3%
  </span>
                <span class="absValue">
    (5/6)
  </span>
            </td>
        </tr>
        <tr>
            <td class="name">FirebaseViewModel$createCalendar$1$1</td>
            <td class="coverageStat">
  <span class="percent">
    100%
  </span>
                <span class="absValue">
    (1/1)
  </span>
            </td>
            <td class="coverageStat">
  <span class="percent">
    100%
  </span>
                <span class="absValue">
    (6/6)
  </span>
            </td>
        </tr>
        <tr>
            <td class="name">FirebaseViewModel$createShare$1</td>
            <td class="coverageStat">
  <span class="percent">
    0%
  </span>
                <span class="absValue">
    (0/1)
  </span>
            </td>
            <td class="coverageStat">
  <span class="percent">
    0%
  </span>
                <span class="absValue">
    (0/9)
  </span>
            </td>
        </tr>
        <tr>
            <td class="name">FirebaseViewModel$deleteCalendar$1</td>
            <td class="coverageStat">
  <span class="percent">
    50%
  </span>
                <span class="absValue">
    (1/2)
  </span>
            </td>
            <td class="coverageStat">
  <span class="percent">
    57.1%
  </span>
                <span class="absValue">
    (4/7)
  </span>
            </td>
        </tr>
        <tr>
            <td class="name">FirebaseViewModel$deleteCalendar$1$1</td>
            <td class="coverageStat">
  <span class="percent">
    0%
  </span>
                <span class="absValue">
    (0/1)
  </span>
            </td>
            <td class="coverageStat">
  <span class="percent">
    0%
  </span>
                <span class="absValue">
    (0/4)
  </span>
            </td>
        </tr>
        <tr>
            <td class="name">FirebaseViewModel$deleteCalendar$1$1$1</td>
            <td class="coverageStat">
  <span class="percent">
    0%
  </span>
                <span class="absValue">
    (0/1)
  </span>
            </td>
            <td class="coverageStat">
  <span class="percent">
    0%
  </span>
                <span class="absValue">
    (0/2)
  </span>
            </td>
        </tr>
        <tr>
            <td class="name">FirebaseViewModel$deleteShare$1</td>
            <td class="coverageStat">
  <span class="percent">
    50%
  </span>
                <span class="absValue">
    (1/2)
  </span>
            </td>
            <td class="coverageStat">
  <span class="percent">
    57.1%
  </span>
                <span class="absValue">
    (4/7)
  </span>
            </td>
        </tr>
        <tr>
            <td class="name">FirebaseViewModel$deleteShare$1$1</td>
            <td class="coverageStat">
  <span class="percent">
    0%
  </span>
                <span class="absValue">
    (0/1)
  </span>
            </td>
            <td class="coverageStat">
  <span class="percent">
    0%
  </span>
                <span class="absValue">
    (0/3)
  </span>
            </td>
        </tr>
        <tr>
            <td class="name">FirebaseViewModel$editCalendar$1</td>
            <td class="coverageStat">
  <span class="percent">
    50%
  </span>
                <span class="absValue">
    (1/2)
  </span>
            </td>
            <td class="coverageStat">
  <span class="percent">
    62.5%
  </span>
                <span class="absValue">
    (5/8)
  </span>
            </td>
        </tr>
        <tr>
            <td class="name">FirebaseViewModel$editCalendar$1$1</td>
            <td class="coverageStat">
  <span class="percent">
    0%
  </span>
                <span class="absValue">
    (0/1)
  </span>
            </td>
            <td class="coverageStat">
  <span class="percent">
    0%
  </span>
                <span class="absValue">
    (0/2)
  </span>
            </td>
        </tr>
        <tr>
            <td class="name">FirebaseViewModel$editEvent$1</td>
            <td class="coverageStat">
  <span class="percent">
    0%
  </span>
                <span class="absValue">
    (0/2)
  </span>
            </td>
            <td class="coverageStat">
  <span class="percent">
    0%
  </span>
                <span class="absValue">
    (0/6)
  </span>
            </td>
        </tr>
        <tr>
            <td class="name">FirebaseViewModel$editEvent$1$1</td>
            <td class="coverageStat">
  <span class="percent">
    0%
  </span>
                <span class="absValue">
    (0/1)
  </span>
            </td>
            <td class="coverageStat">
  <span class="percent">
    0%
  </span>
                <span class="absValue">
    (0/1)
  </span>
            </td>
        </tr>
        <tr>
            <td class="name">FirebaseViewModel$editShare$1</td>
            <td class="coverageStat">
  <span class="percent">
    100%
  </span>
                <span class="absValue">
    (1/1)
  </span>
            </td>
            <td class="coverageStat">
  <span class="percent">
    80%
  </span>
                <span class="absValue">
    (4/5)
  </span>
            </td>
        </tr>
        <tr>
            <td class="name">FirebaseViewModel$editShare$1$1</td>
            <td class="coverageStat">
  <span class="percent">
    0%
  </span>
                <span class="absValue">
    (0/1)
  </span>
            </td>
            <td class="coverageStat">
  <span class="percent">
    0%
  </span>
                <span class="absValue">
    (0/2)
  </span>
            </td>
        </tr>
        <tr>
            <td class="name">FirebaseViewModel$getCalendars$1</td>
            <td class="coverageStat">
  <span class="percent">
    100%
  </span>
                <span class="absValue">
    (2/2)
  </span>
            </td>
            <td class="coverageStat">
  <span class="percent">
    93.8%
  </span>
                <span class="absValue">
    (15/16)
  </span>
            </td>
        </tr>
        <tr>
            <td class="name">FirebaseViewModel$getCalendars$1$1</td>
            <td class="coverageStat">
  <span class="percent">
    100%
  </span>
                <span class="absValue">
    (1/1)
  </span>
            </td>
            <td class="coverageStat">
  <span class="percent">
    30.8%
  </span>
                <span class="absValue">
    (4/13)
  </span>
            </td>
        </tr>
        <tr>
            <td class="name">FirebaseViewModel$getCalendars$1$3</td>
            <td class="coverageStat">
  <span class="percent">
    0%
  </span>
                <span class="absValue">
    (0/1)
  </span>
            </td>
            <td class="coverageStat">
  <span class="percent">
    0%
  </span>
                <span class="absValue">
    (0/17)
  </span>
            </td>
        </tr>
        <tr>
            <td class="name">FirebaseViewModel$getEvents$1</td>
            <td class="coverageStat">
  <span class="percent">
    50%
  </span>
                <span class="absValue">
    (1/2)
  </span>
            </td>
            <td class="coverageStat">
  <span class="percent">
    75%
  </span>
                <span class="absValue">
    (9/12)
  </span>
            </td>
        </tr>
        <tr>
            <td class="name">FirebaseViewModel$getEvents$1$1</td>
            <td class="coverageStat">
  <span class="percent">
    0%
  </span>
                <span class="absValue">
    (0/1)
  </span>
            </td>
            <td class="coverageStat">
  <span class="percent">
    0%
  </span>
                <span class="absValue">
    (0/17)
  </span>
            </td>
        </tr>
        <tr>
            <td class="name">FirebaseViewModel$getEventsByCalendar$1</td>
            <td class="coverageStat">
  <span class="percent">
    50%
  </span>
                <span class="absValue">
    (1/2)
  </span>
            </td>
            <td class="coverageStat">
  <span class="percent">
    57.1%
  </span>
                <span class="absValue">
    (4/7)
  </span>
            </td>
        </tr>
        <tr>
            <td class="name">FirebaseViewModel$getEventsByCalendar$1$1</td>
            <td class="coverageStat">
  <span class="percent">
    0%
  </span>
                <span class="absValue">
    (0/1)
  </span>
            </td>
            <td class="coverageStat">
  <span class="percent">
    0%
  </span>
                <span class="absValue">
    (0/12)
  </span>
            </td>
        </tr>
        <tr>
            <td class="name">FirebaseViewModel$getShares$1</td>
            <td class="coverageStat">
  <span class="percent">
    50%
  </span>
                <span class="absValue">
    (1/2)
  </span>
            </td>
            <td class="coverageStat">
  <span class="percent">
    70%
  </span>
                <span class="absValue">
    (7/10)
  </span>
            </td>
        </tr>
        <tr>
            <td class="name">FirebaseViewModel$getShares$1$1</td>
            <td class="coverageStat">
  <span class="percent">
    0%
  </span>
                <span class="absValue">
    (0/1)
  </span>
            </td>
            <td class="coverageStat">
  <span class="percent">
    0%
  </span>
                <span class="absValue">
    (0/8)
  </span>
            </td>
        </tr>
        <tr>
            <td class="name">FirebaseViewModel$getUserById$1</td>
            <td class="coverageStat">
  <span class="percent">
    50%
  </span>
                <span class="absValue">
    (1/2)
  </span>
            </td>
            <td class="coverageStat">
  <span class="percent">
    50%
  </span>
                <span class="absValue">
    (3/6)
  </span>
            </td>
        </tr>
        <tr>
            <td class="name">FirebaseViewModel$getUserById$1$1</td>
            <td class="coverageStat">
  <span class="percent">
    0%
  </span>
                <span class="absValue">
    (0/1)
  </span>
            </td>
            <td class="coverageStat">
  <span class="percent">
    0%
  </span>
                <span class="absValue">
    (0/4)
  </span>
            </td>
        </tr>
        <tr>
            <td class="name">FirebaseViewModel$getUserShares$1</td>
            <td class="coverageStat">
  <span class="percent">
    100%
  </span>
                <span class="absValue">
    (2/2)
  </span>
            </td>
            <td class="coverageStat">
  <span class="percent">
    90%
  </span>
                <span class="absValue">
    (9/10)
  </span>
            </td>
        </tr>
        <tr>
            <td class="name">FirebaseViewModel$getUserShares$1$1</td>
            <td class="coverageStat">
  <span class="percent">
    100%
  </span>
                <span class="absValue">
    (1/1)
  </span>
            </td>
            <td class="coverageStat">
  <span class="percent">
    50%
  </span>
                <span class="absValue">
    (5/10)
  </span>
            </td>
        </tr>
        <tr>
            <td class="name">FirebaseViewModel$sam$androidx_lifecycle_Observer$0</td>
        </tr>
        <tr>
            <td class="name"><strong>Total</strong></td>
            <td class="coverageStat">
  <span class="percent">
    58.7%
  </span>
                <span class="absValue">
    (44/75)
  </span>
            </td>
            <td class="coverageStat">
  <span class="percent">
    52.2%
  </span>
                <span class="absValue">
    (186/356)
  </span>
            </td>
        </tr>
    </table>

    <br/>
    <br/>


    <pre>
<code class="sourceCode" id="sourceCode">&nbsp;package com.example.sharedcalendar
&nbsp;
&nbsp;
&nbsp;//import java.time.LocalDateTime
&nbsp;import android.content.SharedPreferences
&nbsp;import android.util.Log
&nbsp;import androidx.lifecycle.LiveData
&nbsp;import androidx.lifecycle.MediatorLiveData
&nbsp;import androidx.lifecycle.MutableLiveData
&nbsp;import androidx.lifecycle.ViewModel
&nbsp;import androidx.lifecycle.viewModelScope
&nbsp;import com.example.sharedcalendar.models.Calendar
&nbsp;import com.example.sharedcalendar.models.Event
&nbsp;import com.example.sharedcalendar.models.Share
&nbsp;import com.example.sharedcalendar.models.User
&nbsp;import com.google.firebase.auth.FirebaseAuth
&nbsp;import com.google.firebase.auth.ktx.auth
&nbsp;import com.google.firebase.firestore.FieldPath
&nbsp;import com.google.firebase.firestore.Filter
&nbsp;import com.google.firebase.firestore.FirebaseFirestore
&nbsp;import com.google.firebase.firestore.SetOptions
&nbsp;import com.google.firebase.firestore.ktx.firestore
&nbsp;import com.google.firebase.ktx.Firebase
&nbsp;import kotlinx.coroutines.Dispatchers
&nbsp;import kotlinx.coroutines.launch
&nbsp;import java.time.LocalDate
&nbsp;import java.time.LocalDateTime
&nbsp;import java.time.YearMonth
&nbsp;
<b class="fc">&nbsp;class FirebaseViewModel(</b>
<b class="fc">&nbsp;    private val auth: FirebaseAuth = Firebase.auth,</b>
<b class="fc">&nbsp;    private val db: FirebaseFirestore = Firebase.firestore</b>
<b class="fc">&nbsp;) : ViewModel() {</b>
<b class="fc">&nbsp;    companion object {</b>
<b class="fc">&nbsp;        private val TAG: String = FirebaseViewModel::class.java.name</b>
&nbsp;    }
&nbsp;
<b class="fc">&nbsp;    private val _events = MutableLiveData&lt;MutableList&lt;Event&gt;&gt;()</b>
<b class="fc">&nbsp;    var events: LiveData&lt;MutableList&lt;Event&gt;&gt; = _events</b>
&nbsp;
<b class="fc">&nbsp;    private val _userCalendars = MutableLiveData&lt;MutableList&lt;Calendar&gt;&gt;()</b>
<b class="fc">&nbsp;    var userCalendars: LiveData&lt;MutableList&lt;Calendar&gt;&gt; = _userCalendars</b>
&nbsp;
<b class="fc">&nbsp;    private val _sharedCalendars = MutableLiveData&lt;MutableList&lt;Calendar&gt;&gt;()</b>
<b class="fc">&nbsp;    var sharedCalendars: LiveData&lt;MutableList&lt;Calendar&gt;&gt; = _sharedCalendars</b>
&nbsp;
<b class="fc">&nbsp;    val calendars: LiveData&lt;MutableList&lt;Calendar&gt;&gt; =</b>
<b class="fc">&nbsp;        MediatorLiveData&lt;MutableList&lt;Calendar&gt;&gt;().apply {</b>
<b class="fc">&nbsp;            addSource(_userCalendars) { value = _sharedCalendars + it }</b>
<b class="pc">&nbsp;            addSource(_sharedCalendars) { value = _userCalendars + it }</b>
<b class="fc">&nbsp;        }</b>
&nbsp;
<b class="fc">&nbsp;    private val _userShares = MutableLiveData&lt;MutableList&lt;Share&gt;&gt;()</b>
<b class="fc">&nbsp;    var userShares: LiveData&lt;MutableList&lt;Share&gt;&gt; = _userShares</b>
&nbsp;
<b class="fc">&nbsp;    val user = auth.currentUser!!</b>
<b class="fc">&nbsp;    var calendarsSharedWithUser: MutableList&lt;String&gt; = mutableListOf&lt;String&gt;()</b>
&nbsp;
<b class="fc">&nbsp;    private val _users = MutableLiveData&lt;MutableMap&lt;String, User&gt;&gt;()</b>
<b class="fc">&nbsp;    var users: LiveData&lt;MutableMap&lt;String, User&gt;&gt; = _users</b>
&nbsp;
<b class="fc">&nbsp;    private val _shares = MutableLiveData(mutableMapOf&lt;String, ArrayList&lt;Share&gt;&gt;())</b>
<b class="fc">&nbsp;    var shares: LiveData&lt;MutableMap&lt;String, ArrayList&lt;Share&gt;&gt;&gt; = _shares</b>
&nbsp;
<b class="fc">&nbsp;    private val _enabledCalendars = MutableLiveData&lt;MutableList&lt;String&gt;&gt;()</b>
<b class="fc">&nbsp;    var enabledCalendars: LiveData&lt;MutableList&lt;String&gt;&gt; = _enabledCalendars</b>
&nbsp;
&nbsp;    fun createCalendar(
&nbsp;        uid: String,
&nbsp;        sharedPrefs: SharedPreferences,
&nbsp;        calendar: Calendar
&nbsp;    ) {
<b class="pc">&nbsp;        viewModelScope.launch(Dispatchers.IO) {</b>
&nbsp;            // Add a new document with a generated ID
<b class="fc">&nbsp;            db.collection(&quot;calendars&quot;).add(calendar).addOnSuccessListener { documentReference -&gt;</b>
<b class="fc">&nbsp;                Log.d(TAG, &quot;DocumentSnapshot added with ID: ${documentReference.id}&quot;)</b>
&nbsp;                // Set Default calendar in preferences to created calendar
<b class="fc">&nbsp;                sharedPrefs.edit().putString(&quot;${uid}|default|calendar&quot;, documentReference.id)</b>
<b class="fc">&nbsp;                    .apply()</b>
<b class="fc">&nbsp;                sharedPrefs.edit().putBoolean(&quot;${uid}|calendar|${documentReference.id}&quot;, true)</b>
<b class="fc">&nbsp;                    .apply()</b>
<b class="fc">&nbsp;            }.addOnFailureListener { e -&gt;</b>
<b class="fc">&nbsp;                Log.w(TAG, &quot;Error adding document&quot;, e)</b>
<b class="fc">&nbsp;            }</b>
<b class="fc">&nbsp;        }</b>
<b class="fc">&nbsp;    }</b>
&nbsp;
&nbsp;    fun addShare(newShare: Share) {
<b class="pc">&nbsp;        viewModelScope.launch(Dispatchers.IO) {</b>
<b class="fc">&nbsp;            db.collection(&quot;shares&quot;).add(newShare).addOnSuccessListener { documentReference -&gt;</b>
<b class="nc">&nbsp;                Log.d(TAG, &quot;DocumentSnapshot added with ID: ${documentReference.id}&quot;)</b>
<b class="pc">&nbsp;            }.addOnFailureListener { e -&gt;</b>
<b class="nc">&nbsp;                Log.w(TAG, &quot;Error adding document&quot;, e)</b>
<b class="nc">&nbsp;            }</b>
<b class="fc">&nbsp;        }</b>
<b class="fc">&nbsp;    }</b>
&nbsp;
&nbsp;    fun editShare(shareId: String, editedFields: HashMap&lt;String, String?&gt;) {
<b class="pc">&nbsp;        viewModelScope.launch(Dispatchers.IO) {</b>
<b class="fc">&nbsp;            db.collection(&quot;shares&quot;).document(shareId).set(editedFields, SetOptions.merge())</b>
<b class="fc">&nbsp;                .addOnSuccessListener {</b>
<b class="nc">&nbsp;                    Log.d(TAG, &quot;DocumentSnapshot successfully written!&quot;)</b>
<b class="pc">&nbsp;                }.addOnFailureListener { e -&gt; Log.w(TAG, &quot;Error writing document&quot;, e) }</b>
<b class="fc">&nbsp;        }</b>
<b class="fc">&nbsp;    }</b>
&nbsp;
&nbsp;    fun createShare(newShare: Share) {
&nbsp;
<b class="fc">&nbsp;        db.collection(&quot;shares&quot;)</b>
<b class="fc">&nbsp;            .where(</b>
<b class="fc">&nbsp;                Filter.and(</b>
<b class="fc">&nbsp;                    Filter.equalTo(&quot;calendarId&quot;, newShare.calendarId),</b>
<b class="fc">&nbsp;                    Filter.equalTo(&quot;userEmail&quot;, newShare.userEmail)</b>
&nbsp;                )
<b class="fc">&nbsp;            ).get().addOnSuccessListener { results -&gt;</b>
&nbsp;
<b class="nc">&nbsp;                Log.i(TAG, results.toString())</b>
<b class="nc">&nbsp;                if (results.isEmpty) {</b>
<b class="nc">&nbsp;                    addShare(newShare)</b>
&nbsp;                } else {
<b class="nc">&nbsp;                    val share = results.documents[0]</b>
<b class="nc">&nbsp;                    val editedFields: HashMap&lt;String, String?&gt; =</b>
<b class="nc">&nbsp;                        hashMapOf(&quot;scope&quot; to newShare.scope)</b>
<b class="nc">&nbsp;                    editShare(share.id, editedFields)</b>
&nbsp;                }
<b class="nc">&nbsp;                getShares(calendars.value!!)</b>
&nbsp;
<b class="nc">&nbsp;            }</b>
<b class="fc">&nbsp;    }</b>
&nbsp;
&nbsp;    fun editEvent(eventId: String, editedFields: HashMap&lt;String, Any&gt;) {
<b class="nc">&nbsp;        viewModelScope.launch(Dispatchers.IO) {</b>
<b class="nc">&nbsp;            Log.i(TAG, &quot;editEvent() $eventId $editedFields&quot;)</b>
<b class="nc">&nbsp;            db.collection(&quot;events&quot;).document(eventId).set(editedFields, SetOptions.merge())</b>
<b class="nc">&nbsp;                .addOnSuccessListener {</b>
<b class="nc">&nbsp;                    Log.i(TAG, &quot;Event updated&quot;)</b>
<b class="nc">&nbsp;                }.addOnFailureListener { exception -&gt;</b>
<b class="nc">&nbsp;                    Log.w(TAG, &quot;Error updating event.&quot;, exception)</b>
&nbsp;                }
&nbsp;        }
<b class="nc">&nbsp;    }</b>
&nbsp;
&nbsp;    fun addEventToCalendar(newEvent: HashMap&lt;String, Any?&gt;) {
<b class="pc">&nbsp;        viewModelScope.launch(Dispatchers.IO) {</b>
<b class="fc">&nbsp;            db.collection(&quot;events&quot;).add(newEvent).addOnSuccessListener { documentReference -&gt;</b>
<b class="nc">&nbsp;                Log.d(TAG, &quot;DocumentSnapshot written with ID: ${documentReference.id}&quot;)</b>
<b class="nc">&nbsp;                documentReference.get().addOnSuccessListener { result -&gt;</b>
<b class="nc">&nbsp;                    val event = result.toObject(Event::class.java)</b>
<b class="nc">&nbsp;                    if (event is Event) {</b>
<b class="nc">&nbsp;                        event.id = result.id</b>
<b class="nc">&nbsp;                        event.startTime =</b>
<b class="nc">&nbsp;                            LocalDateTime.parse(result.get(&quot;startTimestamp&quot;).toString())</b>
<b class="nc">&nbsp;                        event.endTime = LocalDateTime.parse(result.get(&quot;endTimestamp&quot;).toString())</b>
&nbsp;
<b class="nc">&nbsp;                        calendars.value?.get(0)?.events?.add(event)</b>
<b class="nc">&nbsp;                        Log.i(TAG, calendars.toString())</b>
&nbsp;
&nbsp;                    }
<b class="nc">&nbsp;                    getEvents()</b>
&nbsp;
&nbsp;                }
<b class="pc">&nbsp;            }.addOnFailureListener { e -&gt;</b>
<b class="nc">&nbsp;                Log.w(TAG, &quot;Error adding document&quot;, e)</b>
<b class="nc">&nbsp;            }</b>
<b class="fc">&nbsp;        }</b>
&nbsp;
<b class="fc">&nbsp;    }</b>
&nbsp;
&nbsp;    fun editCalendar(calendarId: String, editedFields: HashMap&lt;String, Any&gt;) {
<b class="pc">&nbsp;        viewModelScope.launch(Dispatchers.IO) {</b>
<b class="fc">&nbsp;            Log.i(TAG, &quot;editCalendar() $calendarId $editedFields&quot;)</b>
&nbsp;
&nbsp;//            val db = Firebase.firestore
<b class="fc">&nbsp;            db.collection(&quot;calendars&quot;).document(calendarId).set(editedFields, SetOptions.merge())</b>
<b class="fc">&nbsp;                .addOnSuccessListener {</b>
<b class="nc">&nbsp;                    Log.i(TAG, &quot;Calendar updated&quot;)</b>
<b class="pc">&nbsp;                }.addOnFailureListener { exception -&gt;</b>
<b class="nc">&nbsp;                    Log.w(TAG, &quot;Error updating calendar.&quot;, exception)</b>
<b class="nc">&nbsp;                }</b>
<b class="fc">&nbsp;        }</b>
<b class="fc">&nbsp;    }</b>
&nbsp;
&nbsp;    fun deleteCalendar(calendarId: String) {
<b class="pc">&nbsp;        viewModelScope.launch(Dispatchers.IO) {</b>
<b class="fc">&nbsp;            Log.i(TAG, &quot;deleteCalendar()&quot;)</b>
&nbsp;
&nbsp;//            val db = Firebase.firestore
&nbsp;
<b class="fc">&nbsp;            db.collection(&quot;calendars&quot;).document(calendarId).delete().addOnSuccessListener {</b>
<b class="nc">&nbsp;                Log.i(TAG, &quot;Calendar deleted&quot;)</b>
<b class="nc">&nbsp;                db.collection(&quot;events&quot;).whereEqualTo(&quot;calendarId&quot;, calendarId).get()</b>
<b class="nc">&nbsp;                    .addOnSuccessListener { results -&gt;</b>
<b class="nc">&nbsp;                        for (event in results.documents) {</b>
<b class="nc">&nbsp;                            db.collection(&quot;events&quot;).document(event.id).delete()</b>
&nbsp;                        }
&nbsp;                    }
<b class="pc">&nbsp;            }.addOnFailureListener { exception -&gt;</b>
<b class="nc">&nbsp;                Log.w(TAG, &quot;Error deleting calendar.&quot;, exception)</b>
<b class="nc">&nbsp;            }</b>
<b class="fc">&nbsp;        }</b>
<b class="fc">&nbsp;    }</b>
&nbsp;
&nbsp;
&nbsp;    fun getShares(calendars: List&lt;Calendar&gt;) {
<b class="fc">&nbsp;        val newShares = shares.value</b>
<b class="pc">&nbsp;        viewModelScope.launch(Dispatchers.IO) {</b>
<b class="fc">&nbsp;            for (calendar in calendars) {</b>
<b class="fc">&nbsp;                val sharesList = arrayListOf&lt;Share&gt;()</b>
<b class="fc">&nbsp;                db.collection(&quot;shares&quot;).whereEqualTo(&quot;calendarId&quot;, calendar.id).get()</b>
<b class="fc">&nbsp;                    .addOnSuccessListener { result -&gt;</b>
<b class="nc">&nbsp;                        for (share in result.documents) {</b>
<b class="nc">&nbsp;                            val shareEntry = share.toObject(Share::class.java)!!</b>
<b class="nc">&nbsp;                            shareEntry.id = share.id</b>
<b class="nc">&nbsp;                            sharesList.add(shareEntry)</b>
<b class="nc">&nbsp;                            Log.d(TAG, &quot;${share.id} =&gt; ${share.data}&quot;)</b>
&nbsp;                        }
<b class="nc">&nbsp;                        newShares?.set(calendar.id.toString(), sharesList)</b>
<b class="nc">&nbsp;                        _shares.postValue(newShares)</b>
<b class="pc">&nbsp;                    }.addOnFailureListener { exception -&gt;</b>
<b class="nc">&nbsp;                        Log.w(TAG, &quot;Error getting calendar shares.&quot;, exception)</b>
&nbsp;
<b class="nc">&nbsp;                    }</b>
<b class="fc">&nbsp;                Log.d(TAG, newShares.toString())</b>
&nbsp;            }
&nbsp;
<b class="fc">&nbsp;        }</b>
<b class="fc">&nbsp;    }</b>
&nbsp;
<b class="fc">&nbsp;    init {</b>
<b class="fc">&nbsp;        getUserShares()</b>
<b class="fc">&nbsp;    }</b>
&nbsp;
<b class="fc">&nbsp;    fun getUserShares(forceRefresh: Boolean = false) {</b>
&nbsp;//        if(!forceRefresh &amp;&amp; userShares.isInitialized)
<b class="pc">&nbsp;        viewModelScope.launch(Dispatchers.IO) {</b>
<b class="fc">&nbsp;            Log.i(TAG, &quot;getUserShares()&quot;)</b>
<b class="fc">&nbsp;            val shares = ArrayList&lt;Share&gt;()</b>
<b class="fc">&nbsp;            val shareCalendarIds = ArrayList&lt;String&gt;()</b>
<b class="fc">&nbsp;            db.collection(&quot;shares&quot;).whereEqualTo(&quot;userEmail&quot;, user.email).get()</b>
<b class="fc">&nbsp;                .addOnSuccessListener { result -&gt;</b>
<b class="fc">&nbsp;                    for (document in result) {</b>
<b class="nc">&nbsp;                        val share = document.toObject(Share::class.java)</b>
<b class="nc">&nbsp;                        share.id = document.id</b>
<b class="nc">&nbsp;                        shares.add(share)</b>
<b class="nc">&nbsp;                        shareCalendarIds.add(share.calendarId)</b>
<b class="nc">&nbsp;                        Log.d(TAG, &quot;${document.id} =&gt; ${document.data}&quot;)</b>
&nbsp;                    }
<b class="fc">&nbsp;                    Log.i(TAG, calendarsSharedWithUser.toString())</b>
<b class="fc">&nbsp;                    _userShares.postValue(shares)</b>
<b class="fc">&nbsp;                    calendarsSharedWithUser = shareCalendarIds</b>
<b class="fc">&nbsp;                }.addOnFailureListener { exception -&gt;</b>
<b class="fc">&nbsp;                    Log.w(TAG, &quot;Error getting shares.&quot;, exception)</b>
<b class="fc">&nbsp;                }</b>
<b class="fc">&nbsp;        }</b>
<b class="fc">&nbsp;    }</b>
&nbsp;
&nbsp;    private fun isCalendarEnabled(calendarPrefs: Map&lt;String, Any?&gt;, calendarId: String): Boolean {
<b class="nc">&nbsp;        val calendarKey = &quot;${FirebaseAuth.getInstance().uid}|calendar|${calendarId}&quot;</b>
<b class="nc">&nbsp;        Log.i(TAG, &quot;Check isCalendarEnabled $calendarKey&quot;)</b>
<b class="nc">&nbsp;        return !calendarPrefs.containsKey(calendarKey) || calendarPrefs.getValue(</b>
<b class="nc">&nbsp;            calendarKey</b>
<b class="nc">&nbsp;        ) == true</b>
&nbsp;    }
&nbsp;
&nbsp;    private var isUserCalendarFetched = false
&nbsp;    private var isSharedCalendarFetched = false
<b class="fc">&nbsp;    fun getCalendars(calendarPrefs: Map&lt;String, Any?&gt;, forceRefresh: Boolean = false) {</b>
<b class="fc">&nbsp;        if (isUserCalendarFetched &amp;&amp; isSharedCalendarFetched &amp;&amp; !forceRefresh) return</b>
<b class="fc">&nbsp;        isUserCalendarFetched = true</b>
<b class="fc">&nbsp;        isSharedCalendarFetched = true</b>
<b class="pc">&nbsp;        viewModelScope.launch(Dispatchers.IO) {</b>
<b class="fc">&nbsp;            Log.i(TAG, &quot;getCalendars()&quot;)</b>
&nbsp;//            val db = Firebase.firestore
&nbsp;
<b class="fc">&nbsp;            val calendars1 = ArrayList&lt;Calendar&gt;()</b>
<b class="fc">&nbsp;            val calendarsEnabled = ArrayList&lt;String&gt;()</b>
<b class="fc">&nbsp;            db.collection(&quot;calendars&quot;)</b>
<b class="fc">&nbsp;                .whereEqualTo(&quot;ownerId&quot;, user.uid).get()</b>
<b class="fc">&nbsp;                .addOnSuccessListener { documents -&gt;</b>
<b class="fc">&nbsp;                    for (document in documents) {</b>
<b class="nc">&nbsp;                        val calendar = document.toObject(Calendar::class.java)</b>
<b class="nc">&nbsp;                        calendar.id = document.id</b>
<b class="nc">&nbsp;                        calendar.owner = null</b>
<b class="nc">&nbsp;                        calendar.scope = &quot;Full&quot;</b>
<b class="nc">&nbsp;                        calendar.events = getEventsByCalendar(document.id, &quot;Full&quot;)</b>
&nbsp;                        // Check if calendar is enabled in preferences
<b class="nc">&nbsp;                        if (isCalendarEnabled(calendarPrefs, document.id))</b>
<b class="nc">&nbsp;                            calendarsEnabled.add(document.id)</b>
&nbsp;
<b class="nc">&nbsp;                        calendars1.add(calendar)</b>
<b class="nc">&nbsp;                        Log.d(TAG, &quot;${document.id} =&gt; ${document.data}&quot;)</b>
&nbsp;                    }
<b class="fc">&nbsp;                    _userCalendars.postValue(calendars1)</b>
<b class="fc">&nbsp;                    _enabledCalendars.postValue(calendarsEnabled)</b>
<b class="fc">&nbsp;                }.addOnFailureListener { exception -&gt;</b>
<b class="fc">&nbsp;                    Log.w(TAG, &quot;Error getting documents.&quot;, exception)</b>
<b class="fc">&nbsp;                }</b>
&nbsp;
<b class="fc">&nbsp;            val calendars2 = ArrayList&lt;Calendar&gt;()</b>
<b class="fc">&nbsp;            if (calendarsSharedWithUser.isNotEmpty()) {</b>
<b class="fc">&nbsp;                Log.d(TAG, &quot;Getting calendar shares $calendarsSharedWithUser&quot;)</b>
<b class="fc">&nbsp;                db.collection(&quot;calendars&quot;).whereIn(FieldPath.documentId(), calendarsSharedWithUser)</b>
<b class="fc">&nbsp;                    .get().addOnSuccessListener { documents -&gt;</b>
<b class="nc">&nbsp;                        Log.d(TAG, &quot;calendars2 size ${documents.size()}&quot;)</b>
<b class="nc">&nbsp;                        for (document in documents) {</b>
<b class="nc">&nbsp;                            val calendar = document.toObject(Calendar::class.java)</b>
<b class="nc">&nbsp;                            calendar.id = document.id</b>
<b class="nc">&nbsp;                            calendar.owner = getUserById(calendar.ownerId)</b>
<b class="nc">&nbsp;                            val scope =</b>
<b class="nc">&nbsp;                                userShares.value?.filter { c -&gt; c.calendarId == document.id }</b>
<b class="nc">&nbsp;                                    ?.toTypedArray()?.get(0)?.scope</b>
<b class="nc">&nbsp;                            calendar.events = getEventsByCalendar(document.id, scope)</b>
<b class="nc">&nbsp;                            calendar.scope = scope</b>
&nbsp;
&nbsp;                            // Check if calendar is enabled in preferences
<b class="nc">&nbsp;                            if (isCalendarEnabled(calendarPrefs, document.id)) {</b>
<b class="nc">&nbsp;                                calendarsEnabled.add(document.id)</b>
&nbsp;                            }
&nbsp;
<b class="nc">&nbsp;                            Log.d(TAG, &quot;Shared with me: ${document.id} =&gt; ${document.data}&quot;)</b>
<b class="nc">&nbsp;                            calendars2.add(calendar)</b>
&nbsp;                        }
<b class="nc">&nbsp;                        _sharedCalendars.postValue(calendars2)</b>
<b class="nc">&nbsp;                        _enabledCalendars.postValue(calendarsEnabled)</b>
<b class="nc">&nbsp;                    }</b>
&nbsp;            }
<b class="fc">&nbsp;        }</b>
<b class="fc">&nbsp;    }</b>
&nbsp;
<b class="fc">&nbsp;    fun getEvents(forceRefresh: Boolean = false) {</b>
&nbsp;        // Prevent unnecessary API calls
<b class="fc">&nbsp;        if (events.value != null &amp;&amp; !forceRefresh) return</b>
<b class="fc">&nbsp;        Log.d(TAG, &quot;getCurrentMonthEvents&quot;)</b>
<b class="pc">&nbsp;        viewModelScope.launch(Dispatchers.IO) {</b>
&nbsp;
<b class="fc">&nbsp;            val calendarEvents = ArrayList&lt;Event&gt;()</b>
&nbsp;//            val db = Firebase.firestore
<b class="fc">&nbsp;            Log.i(TAG, &quot;Calendars to find events for $calendars&quot;)</b>
<b class="fc">&nbsp;            if (calendars.value?.isNotEmpty() == true) {</b>
<b class="fc">&nbsp;                for (calendar in calendars.value!!) {</b>
<b class="fc">&nbsp;                    Log.i(TAG, &quot;Finding Events for Calendar ${calendar.name}&quot;)</b>
<b class="fc">&nbsp;                    db.collection(&quot;events&quot;).whereEqualTo(&quot;calendarId&quot;, calendar.id).get()</b>
<b class="fc">&nbsp;                        .addOnSuccessListener { result -&gt;</b>
<b class="nc">&nbsp;                            for (document in result) {</b>
<b class="nc">&nbsp;                                val event = document.toObject(Event::class.java)</b>
&nbsp;
<b class="nc">&nbsp;                                event.id = document.id</b>
&nbsp;
<b class="nc">&nbsp;                                if (calendar.scope == &quot;Availability&quot;) {</b>
<b class="nc">&nbsp;                                    event.title = &quot;Busy&quot;</b>
<b class="nc">&nbsp;                                    event.description = &quot;&quot;</b>
&nbsp;                                }
<b class="nc">&nbsp;                                event.scope = calendar.scope.toString()</b>
&nbsp;
<b class="nc">&nbsp;                                event.startTime =</b>
<b class="nc">&nbsp;                                    LocalDateTime.parse(document.get(&quot;startTimestamp&quot;).toString())</b>
<b class="nc">&nbsp;                                event.endTime =</b>
<b class="nc">&nbsp;                                    LocalDateTime.parse(document.get(&quot;endTimestamp&quot;).toString())</b>
<b class="nc">&nbsp;                                if (event.color.isEmpty() &amp;&amp; calendar.color.toString()</b>
<b class="nc">&nbsp;                                        .isNotEmpty()</b>
&nbsp;                                ) {
<b class="nc">&nbsp;                                    event.color = calendar.color.toString()</b>
&nbsp;                                }
<b class="nc">&nbsp;                                calendarEvents.add(event)</b>
<b class="nc">&nbsp;                                _events.postValue(calendarEvents)</b>
&nbsp;                            }
<b class="pc">&nbsp;                        }.addOnFailureListener { exception -&gt;</b>
<b class="nc">&nbsp;                            Log.w(TAG, &quot;Error getting documents.&quot;, exception)</b>
<b class="nc">&nbsp;                        }</b>
&nbsp;                }
&nbsp;            }
<b class="fc">&nbsp;        }</b>
<b class="fc">&nbsp;    }</b>
&nbsp;
&nbsp;
&nbsp;    operator fun &lt;T&gt; MutableLiveData&lt;MutableList&lt;T&gt;&gt;.plus(list: MutableList&lt;T&gt;): MutableList&lt;T&gt; {
<b class="fc">&nbsp;        val newList = mutableListOf&lt;T&gt;()</b>
<b class="fc">&nbsp;        this.value?.let { newList.addAll(it) }</b>
<b class="fc">&nbsp;        newList.addAll(list)</b>
<b class="fc">&nbsp;        return newList</b>
&nbsp;    }
&nbsp;
&nbsp;    operator fun &lt;T&gt; MutableLiveData&lt;MutableMap&lt;String, T&gt;&gt;.set(key: String, item: T) {
<b class="nc">&nbsp;        val value = this.value ?: mutableMapOf()</b>
<b class="nc">&nbsp;        value[key] = item</b>
<b class="nc">&nbsp;        this.value = value</b>
<b class="nc">&nbsp;    }</b>
&nbsp;
&nbsp;    fun getUserById(
&nbsp;        userId: String
&nbsp;    ): User? {
<b class="fc">&nbsp;        if (users.value?.get(userId) != null) {</b>
<b class="fc">&nbsp;            return users.value?.get(userId)</b>
&nbsp;        }
<b class="fc">&nbsp;        var user: User? = null</b>
&nbsp;//        val db = Firebase.firestore
<b class="pc">&nbsp;        viewModelScope.launch(Dispatchers.IO) {</b>
<b class="fc">&nbsp;            db.collection(&quot;users&quot;).document(userId).get().addOnSuccessListener { result -&gt;</b>
<b class="nc">&nbsp;                user = result.toObject(User::class.java)</b>
<b class="nc">&nbsp;                user?.id = result.id</b>
<b class="nc">&nbsp;                if (user != null) _users[userId] = user!!</b>
<b class="pc">&nbsp;            }.addOnFailureListener { exception -&gt;</b>
<b class="nc">&nbsp;                Log.w(TAG, &quot;Error getting user with specified ID. &quot;, exception)</b>
<b class="nc">&nbsp;            }</b>
<b class="fc">&nbsp;        }</b>
<b class="fc">&nbsp;        return user</b>
&nbsp;    }
&nbsp;
<b class="fc">&nbsp;    fun getEventsByCalendar(</b>
<b class="fc">&nbsp;        calendarId: String, scope: String?, currentMonthOnly: Boolean = false</b>
&nbsp;    ): ArrayList&lt;Event&gt; {
<b class="fc">&nbsp;        val eventArrayList: ArrayList&lt;Event&gt; = ArrayList()</b>
&nbsp;
<b class="pc">&nbsp;        viewModelScope.launch(Dispatchers.IO) {</b>
<b class="fc">&nbsp;            db.collection(&quot;events&quot;).whereEqualTo(&quot;calendarId&quot;, calendarId).get()</b>
<b class="fc">&nbsp;                .addOnSuccessListener { result -&gt;</b>
<b class="nc">&nbsp;                    for (document in result) {</b>
<b class="nc">&nbsp;                        val event = document.toObject(Event::class.java)</b>
&nbsp;
<b class="nc">&nbsp;                        event.id = document.id</b>
&nbsp;
<b class="nc">&nbsp;                        if (scope == &quot;Availability&quot;) {</b>
<b class="nc">&nbsp;                            event.title = &quot;Busy&quot;</b>
<b class="nc">&nbsp;                            event.description = &quot;&quot;</b>
&nbsp;                        }
&nbsp;
<b class="nc">&nbsp;                        event.startTime =</b>
<b class="nc">&nbsp;                            LocalDateTime.parse(document.get(&quot;startTimestamp&quot;).toString())</b>
<b class="nc">&nbsp;                        event.endTime = LocalDateTime.parse(document.get(&quot;endTimestamp&quot;).toString())</b>
<b class="nc">&nbsp;                        eventArrayList.add(event)</b>
&nbsp;
<b class="nc">&nbsp;                        Log.wtf(TAG, &quot;${document.id} =&gt; $event =&gt; $eventArrayList&quot;)</b>
&nbsp;                    }
<b class="pc">&nbsp;                }.addOnFailureListener { exception -&gt;</b>
<b class="nc">&nbsp;                    Log.w(TAG, &quot;Error getting documents.&quot;, exception)</b>
<b class="nc">&nbsp;                }</b>
&nbsp;            // TODO: event array list returns before on successListener is called
&nbsp;//            Log.wtf(TAG, eventArrayList.toString())
<b class="fc">&nbsp;        }</b>
<b class="fc">&nbsp;        return eventArrayList</b>
&nbsp;    }
&nbsp;
&nbsp;    fun getGroupedEvents(): Map&lt;LocalDate, List&lt;Event&gt;&gt;? {
<b class="fc">&nbsp;        val currentMonth = YearMonth.now()</b>
&nbsp;//        val events = getEvents()
<b class="fc">&nbsp;        if (events.value == null) {</b>
<b class="fc">&nbsp;            return null</b>
&nbsp;        }
<b class="fc">&nbsp;        return buildList {</b>
<b class="fc">&nbsp;            for (event in events.value!!) {</b>
<b class="fc">&nbsp;                if (enabledCalendars.value?.contains(event.calendarId) == true)</b>
<b class="fc">&nbsp;                    currentMonth.atDay(event.startTime.dayOfMonth).also {</b>
<b class="fc">&nbsp;                        add(event)</b>
<b class="fc">&nbsp;                    }</b>
&nbsp;            }
<b class="fc">&nbsp;        }.groupBy { it.startTime.toLocalDate() }</b>
&nbsp;    }
&nbsp;
&nbsp;    fun deleteShare(share: Share) {
<b class="fc">&nbsp;        val shareId = share.id</b>
<b class="fc">&nbsp;        if (shareId.isNullOrEmpty()) {</b>
<b class="nc">&nbsp;            Log.w(TAG, &quot;Share ID is null&quot;)</b>
<b class="nc">&nbsp;            return</b>
&nbsp;        }
&nbsp;
<b class="pc">&nbsp;        viewModelScope.launch(Dispatchers.IO) {</b>
<b class="fc">&nbsp;            Log.i(TAG, &quot;deleteCalendar()&quot;)</b>
&nbsp;
<b class="fc">&nbsp;            db.collection(&quot;shares&quot;).document(shareId).delete().addOnSuccessListener {</b>
<b class="nc">&nbsp;                Log.i(TAG, &quot;share deleted&quot;)</b>
&nbsp;
<b class="nc">&nbsp;                calendars.value?.let { it1 -&gt; getShares(it1) }</b>
&nbsp;
<b class="pc">&nbsp;            }.addOnFailureListener { exception -&gt;</b>
<b class="nc">&nbsp;                Log.w(TAG, &quot;Error deleting Share.&quot;, exception)</b>
<b class="nc">&nbsp;            }</b>
<b class="fc">&nbsp;        }</b>
<b class="fc">&nbsp;    }</b>
&nbsp;
&nbsp;    fun getEventThisDay(date: LocalDate): ArrayList&lt;Event&gt; {
&nbsp;
&nbsp;//        val events = getEvents()
<b class="nc">&nbsp;        if (events.value == null) {</b>
<b class="nc">&nbsp;            return arrayListOf()</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        return events.value?.filter {</b>
<b class="nc">&nbsp;            Log.d(</b>
<b class="nc">&nbsp;                TAG,</b>
<b class="nc">&nbsp;                &quot;Event: ${</b>
<b class="nc">&nbsp;                    it.startTime.toLocalDate().isEqual(date)</b>
<b class="nc">&nbsp;                } ${it.startTime.toLocalDate()} $date&quot;</b>
&nbsp;            )
<b class="nc">&nbsp;            it.startTime.toLocalDate().isEqual(date) ||</b>
<b class="nc">&nbsp;                    (date.isAfter(it.startTime.toLocalDate()) &amp;&amp; date.isBefore(it.endTime.toLocalDate()))</b>
&nbsp;
&nbsp;        } as ArrayList&lt;Event&gt;
&nbsp;    }
&nbsp;
<b class="fc">&nbsp;}</b>
&nbsp;
</code>
</pre>
</div>

<script type="text/javascript">
(function() {
    var msie = false, msie9 = false;
    /*@cc_on
      msie = true;
      @if (@_jscript_version >= 9)
        msie9 = true;
      @end
    @*/

    if (!msie || msie && msie9) {
      hljs.highlightAll()
      hljs.initLineNumbersOnLoad();
    }
})();

</script>

<div class="footer">

    <div style="float:right;">generated on 2024-05-12 21:32</div>
</div>
</body>
</html>
